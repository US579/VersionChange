---
name: IR8 Maori Authority return
model:
  fields:
    <<: !include
      source: ../../../Common/taxcalculatormodel.yml
      path: taxCalculatorFields
    
    <<: !include
      source: ../../../Common/provCalculatorModel.yml
      path: provCalculatorFields
 
    entityType:
      type: text
      defaultValue:  C
    taxYear:
      type: number
      decimals: 0
      defaultValue:  "2020"
    irdNumber:
      type: text
      mandatory: true
    nonResidentIndicator:
      defaultValue: false
      type: boolean
    isNilReturn:
      defaultValue: false
      type: boolean
    isFinalReturn:
      defaultValue: false
      type: boolean
    isAmended:
      defaultValue: false
      type: boolean
    amendReason:
      mandatory: = isAmended <> FALSE
      options:
        - label: Calculation error
          value: MATH
        - label: Incorrect amount entered
          value: KEY
        - label: Transposition error
          value: TRNSPO
        - label: Other
          value: OTHER
      type: select
    amendDetails:
      mandatory: = isAmended <> FALSE
      type: text
    submissionKey:
      maxLength: 32
      type: text
    interestIncome_totalTaxPaid:
      decimals: 2
      type: number
    interestIncome_totalIncome:
      decimals: 2
      type: number
    netRentalIncome:
      decimals: 2
      type: number
    netTradingIncome:
      decimals: 2
      type: number
    residentialRentalIncome_Indicator:
      type: select
      options:
        - label: Portfolio
          value: P
        - label: Individual
          value: I
        - label: Combined
          value: C
    residentialRentalIncome_totalIncome:
      type: number
      decimals: 2
    residentialRentalIncome_excessDeductionsBroughtForward:
      type: number
      decimals: 2
    residentialRentalIncome_residentialRentalDeductions:
      type: number
      decimals: 2
    residentialRentalIncome_deductionsClaimedThisYear:
      type: number
      decimals: 2
    residentialRentalIncome_excessDeductionsCarriedForward:
      type: number
      decimals: 2
      value: =IF(residentialRentalIncome_excessDeductionsBroughtForward + residentialRentalIncome_residentialRentalDeductions - residentialRentalIncome_deductionsClaimedThisYear > 0,
              residentialRentalIncome_excessDeductionsBroughtForward + residentialRentalIncome_residentialRentalDeductions - residentialRentalIncome_deductionsClaimedThisYear,NULL)
    residentialRentalIncome_netIncome:
      type: number
      decimals: 2
      value: =IF(residentialRentalIncome_totalIncome - residentialRentalIncome_deductionsClaimedThisYear = 0,
               NULL,residentialRentalIncome_totalIncome - residentialRentalIncome_deductionsClaimedThisYear)
    # pieIncome_totalTaxCredits:
    #   decimals: 2
    #   type: number
    # pieIncome_totalIncome:
    #   decimals: 2
    #   type: number
    dividendIncome_totalImputationCredits:
      decimals: 2
      type: number
    dividendIncome_totalRWTCredits:
      decimals: 2
      type: number
    dividendIncome_totalGrossDividends:
      decimals: 2
      type: number
    maoriAuthorityDistributions_totalMACredits:
      decimals: 2
      type: number
    maoriAuthorityDistributions_totalMADistributions:
      decimals: 2
      type: number
    # partnershipEstateTrustIncome_totalTaxCredits:
    #   decimals: 2
    #   type: number
    # partnershipEstateTrustIncome_totalIncome:
    #   decimals: 2
    #   type: number
    overseasIncome_totalTaxPaid:
      decimals: 2
      type: number
    overseasIncome_totalIncome:
      decimals: 2
      type: number
    # businessOrRentalIncome:
    #   decimals: 2
    #   type: number
    # totalGrossPremium:
    #   decimals: 2
    #   type: number
    # totalGrossPremiumPaidToSwitzerland:
    #   decimals: 2
    #   type: number
    # totalTaxablePremium:
    #   decimals: 2
    #   type: number
    otherIncome:
      decimals: 2
      type: number
    saleOfProperty:
      decimals: 2
      type: number
    # totalRWTDeducted:
    #   decimals: 2
    #   type: number
    rlwtCredit:
      decimals: 2
      type: number
    # otherTaxCredits:
    #   decimals: 2
    #   type: number
    totalTaxCredits:
      decimals: 2
      type: number
      # value: = rlwt_Credit + maoriAuthorityDistributions_totalMACredits + interestIncome_totalTaxPaid + dividendIncome_totalRWTCredits
      value: = rlwt_Credit + maoriAuthorityDistributions_totalMACredits + interestIncome_totalTaxPaid + dividendIncome_totalRWTCredits

    totalIncomeSubtotal:
      decimals: 2
      type: number
      value: =residentialRentalIncome_netIncome + saleOfProperty + interestIncome_totalIncome + dividendIncome_totalGrossDividends + maoriAuthorityDistributions_totalMADistributions + overseasIncome_totalIncome + netRentalIncome + netTradingIncome + otherIncome
    # donationsMade:
    #   decimals: 2
    #   type: number     
    lossesBroughtForward:
      decimals: 2
      type: number
    lossesClaimedThisYear:
      decimals: 2
      type: number
    # incomeAfterNetLosses:
    #   decimals: 2
    #   type: number
    #   value: = totalIncomeSubtotal - donationsMade -lossesClaimedThisYear  
    # netLossesToFrom:
    #   decimals: 2
    #   type: number
    # subventionPaymentsToFrom:
    #   decimals: 2
    #   type: number
    adjustmentsOutsideFinancialAccounts:
      decimals: 2
      type: number
    subtotalAfterAdjustments:
      decimals: 2
      type: number
      value: = totalIncomeSubtotal +  adjustmentsOutsideFinancialAccounts
    donationsMade:
      decimals: 2
      type: number
    subtotalAfterDonationmade:
      decimals: 2
      type: number
      value: = subtotalAfterAdjustments - donationsMade
    totalTaxableIncome:
      decimals: 2
      type: number
      value:  =ROUNDDOWN(totalIncomeSubtotal + adjustmentsOutsideFinancialAccounts - donationsMade - lossesClaimedThisYear,0)
    # taxOnTaxableIncome:
    #   decimals: 2
    #   type: number
    overseasIncometotalTaxPaid:
      decimals: 2
      type: number
      value:  =overseasIncome_totalTaxPaid
    taxAfterOverseasTax:
      decimals: 2
      type: number
      value: =IF(taxOnTaxableIncome >= overseasIncometotalTaxPaid , taxOnTaxableIncome - overseasIncometotalTaxPaid , 0)
    # foreignInvestorTaxCredit:
    #   decimals: 2
    #   type: number
    # taxAfterFInvestorTax:
    #   type: number
    #   decimals: 2
    #   value: =taxAfterOverseasTax - foreignInvestorTaxCredit
    dividendImputationCredits:
      decimals: 2
      type: number
      value: =dividendIncome_totalImputationCredits
    taxAfterImpCredits:
      type: number
      decimals: 2
      value:  =IF(taxAfterOverseasTax >=dividendImputationCredits , taxAfterOverseasTax - dividendImputationCredits ,0)
    researchAndDevelopment_nonrefundableCredit:
      type: number
      decimals: 2
    # researchAndDevelopment_refundableCredit:
    #   type: number
    #   decimals: 2
    taxAfterRDCredits:
      type: number
      decimals: 2
      value:  =IF(taxAfterImpCredits >= researchAndDevelopment_nonrefundableCredit , 
                taxAfterImpCredits - researchAndDevelopment_nonrefundableCredit ,0)
    rlwt_Credit:
      decimals: 2
      type: number
      value: =rlwtCredit
    rlwt_CreditSubtotal:
      decimals: 2
      type: number
      value: =taxAfterRDCredits - rlwt_Credit
    # changing value ot totaltaxcredits
    totalremainingTaxCredits:
      decimals: 2
      type: number
      # value:  =rlwtCredit + researchAndDevelopment_nonrefundableCredit + dividendImputationCredits + overseasIncometotalTaxPaid
      value: =totalTaxCredits
    residualIncomeTax:
      decimals: 2
      type: number
      value: =rlwt_CreditSubtotal - totalremainingTaxCredits
    provisionalTaxPaid:
      decimals: 2
      type: number
    penaltiesDue:
      decimals: 2
      type:  number
    transfersFromOtherReturns:
      decimals: 2
      type: number
    terminalTax:
      decimals: 2
      type: number
      value:  =residualIncomeTax - provisionalTaxPaid + penaltiesDue - transfersFromOtherReturns
# Transfer section
    overpaymentProvisionalTax:
      decimals: 2
      type: number
    totalRefundDue:
      decimals: 2
      type: number
      # value:  =terminalTax + overpaymentProvisionalTax
    transferRefundTo:
      type: list
      maxRows:  10
      fields:
        transferIrdNumber:
          type: number
          decimals: 0     
        transferAccountType:
          options:
            - label: Income tax
              value: INC
            - label: Approved issuer levy
              value: AIL
            - label: Account information provider
              value: AIP
            - label: Common reporting standard
              value: CRS
            - label: Dividend withholding tax
              value: DWT
            - label: Fringe benefit tax
              value: FBT
            - label: Gaming machine duty
              value: GMD
            - label: GST on goods sold in satisfaction of debt
              value: GSD
            - label: Goods and services tax
              value: GST
            - label: Resident withholding tax on interest
              value: IPS
            - label: Resident withholding tax on interest (exempt recipient)
              value: IPE
            - label: Non-resident withholding tax
              value: NRT
            - label: Portfolio investment entity tax
              value: PIE
            - label: Payroll subsidy account
              value: PRS
            - label: 'Tax credits - donations, childcare, housekeeper'
              value: REB
            - label: Resident land withholding tax
              value: RLT
            - label: Resident withholding tax on specified dividends
              value: RWT
            - label: Student loan
              value: SLS
            - label: Working for families tax credits
              value: FAM
          type: select
        transferAmount:
          decimals: 2
          type: number
        associatedCustomer:
          defaultValue: false
          type: boolean
        transferFilingPeriod:
          defaultValue: 31/03/2020
          type: date
    transferTotal:
      decimals: 2
      type: number
      value:  =SUM(transferRefundTo:transferAmount)    
    transferRemaining:
      decimals: 2
      type: number
      value:  =totalRefundDue + transferTotal
    provTaxEvenSplit:
      defaultValue: false
      type: boolean
    provisionalTax_provisionalTaxStartDate:
      type: date
    provisionalTax_provisionalTaxOption:
      mandatory: true
      options:
        - label: Standard
          value: STD
        - label: Estimated
          value: EST
        - label: Ratio
          value: RATIO
      type: select
    provisionalTaxCalc:
      type: number
      decimals: 2
      value:  = IF(residualIncomeTax > 2500 , IF(provisionalTax_provisionalTaxOption = "STD" , residualIncomeTax * 1.05 , 0 ) , 0 )
    provFromTaxManager:
      type: number
      decimals: 2
    # provisionalTax_provisionalTaxPayable:
    #   decimals: 2
    #   type: number
    #   value:  = IF(provisionalTax_provisionalTaxOption = "STD" , provisionalTaxCalc , provFromTaxManager )
    paymentsMadeToNonResidents:
      type: boolean
      defaultValue: false
    withholdingTaxDeducted:
      type: boolean
      defaultValue: false
    disclosureOfForeignInterestRequired:
      type: boolean
      defaultValue: false    
    repurchasedRedeemedCancelledShares:
      type: number
      decimals: 2
    foreignSourcedDividends:
      type: boolean
      defaultValue: false
    foreignControlIndicator:
      type: boolean
      defaultValue: false
    lowestEconomicShareholderInterest:
      type: number
      decimals: 2
    useOfMoneyInterest:
      type: number
      decimals: 2
      defaultValue: "0"
    uomiStartDate:
      type: date
      defaultValue: 31/03/2020
    taxCreditsForTM:
      type: number
      decimals: 2
      defaultValue: "0"