---
name: Expense transaction analysis
model:
  fields:
    expenses:
      type: list
      fields:
        AccountCode:
          type: text
        Date:
          type: date
        Memo:
          type: text
        TrialBalanceAmount:
          type: number
        GSTAmount:
          type: number
        GrossAmount:
          type: number
          value: '=expenses#CURR#TrialBalanceAmount + expenses#CURR#GSTAmount'
        PercentageDeductible:
          type: number
          defaultValue: '100'
        DeductibleAmount:
          type: number
          value: = ROUND(expenses#CURR#GrossAmount * expenses#CURR#PercentageDeductible / 100,2)
        DeductibleGST:
          type: number 
          value: = ROUND(expenses#CURR#GSTAmount * expenses#CURR#PercentageDeductible / 100,2)
        NonDeductibleAmount:
          type: number
          value: = expenses#CURR#GrossAmount - expenses#CURR#DeductibleAmount
        NonDeductibleGST:
          type: number
          value: = expenses#CURR#GSTAmount - expenses#CURR#DeductibleGST

    TotalTrialBalance:
      type: number
      value: '=SUM(expenses:TrialBalanceAmount)'
    TotalGSTAmount:
      type: number
      value: '=SUM(expenses:GSTAmount)'
    TotalGrossAmount:
      type: number
      value: '=SUM(expenses:GrossAmount)'
    TotalDeductibleAmount:
      type: number
      value: '=SUM(expenses:DeductibleAmount)'
    TotalDeductibleGST:
      type: number
      value: '=SUM(expenses:DeductibleGST)'
    TotalNonDeductbleAmount:
      type: number
      value: '=SUM(expenses:NonDeductibleAmount)'
    TotalNonDeductibleGST:
      type: number
      value: '=SUM(expenses:NonDeductibleGST)'


    LedgerDetails:
      type: list
      fields:
        AccountName:
          type: text
    AccountNameFromList:
      type: text
      value: = LedgerDetails:AccountName
    LedgerAmounts:
      type: list
      fields:
        AccountName:
          type: text
          value: = AccountNameFromList
        AccountCode:
          type: text
        Balance:
          type: number
    TotalBalance:
      type: number
      value: '=SUM(LedgerAmounts:Balance)'
    Variance:
      type: number
      value: '=TotalDeductibleAmount - TotalBalance'

    AdjustmentRequired:
      type: boolean
      defaultValue: true
    GSTAdjustment:
      type: number
      value: = IF(
                  AdjustmentRequired,
                  TotalNonDeductibleGST,
                  0)

    NotesList:
      type: list
      fields:
        Note:
          type: textArea

