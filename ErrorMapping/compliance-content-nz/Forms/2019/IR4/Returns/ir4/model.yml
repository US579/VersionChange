---
name: IR4 Company return
model:
  fields:
    <<: !include
      source: ../../../Common/taxcalculatormodel.yml
      path: taxCalculatorFields
    entityType:
      type: text
      defaultValue:  C
    taxYear:
      type: number
      decimals: 0
      defaultValue:  "2020"
    irdNumber:
      type: number
      decimals: 0
      mandatory: true
    nonResidentIndicator:
      defaultValue: false
      type: boolean
    isNilReturn:
      defaultValue: false
      type: boolean
    isFinalReturn:
      defaultValue: false
      type: boolean
    isAmended:
      defaultValue: false
      type: boolean
    amendReason:
      mandatory: = isAmended <> FALSE
      type: select
      options:
        - label: Calculation error
          value: MATH
        - label: Incorrect amount entered
          value: KEY
        - label: Transposition error
          value: TRNSPO
        - label: Other
          value: OTHER
    amendDetails:
      mandatory: = isAmended <> FALSE
      type: text
    submissionKey:
      maxLength: 32
      type: text
    incomeAfterNetLosses:
      decimals: 2
      type: number
      value: = totalIncomeSubtotal - donationsMade -lossesClaimedThisYear
    lossesBroughtForward:
      decimals: 2
      type: number
    lossesClaimedThisYear:
      decimals: 2
      type: number
    netLossesToFrom:
      decimals: 2
      type: number
    schedularPayments_totalIncome:
      decimals: 2
      type: number
    schedularPayments_withholdingTaxDeducted:
      decimals: 2
      type: number
    rlwtCredit:
      decimals: 2
      type: number
    saleOfProperty:
      decimals: 2
      type: number
    interestIncome_totalTaxPaid:
      decimals: 2
      type: number
    interestIncome_totalIncome:
      decimals: 2
      type: number
    pieIncome_totalTaxCredits:
      decimals: 2
      type: number
    pieIncome_totalIncome:
      decimals: 2
      type: number      
    dividendIncome_totalImputationCredits:
      decimals: 2
      type: number
    dividendIncome_totalRWTCredits:
      decimals: 2
      type: number
    dividendIncome_totalGrossDividends:
      decimals: 2
      type: number
    maoriAuthorityDistributions_totalMACredits:
      decimals: 2
      type: number
    maoriAuthorityDistributions_totalMADistributions:
      decimals: 2
      type: number
    partnershipEstateTrustIncome_totalTaxCredits:
      decimals: 2
      type: number
    partnershipEstateTrustIncome_totalIncome:
      decimals: 2
      type: number
    overseasIncome_totalTaxPaid:
      decimals: 2
      type: number
    overseasIncome_totalIncome:
      decimals: 2
      type: number
    businessOrRentalIncome:
      decimals: 2
      type: number
    totalGrossPremium:
      decimals: 2
      type: number
    totalGrossPremiumPaidToSwitzerland:
      decimals: 2
      type: number
    totalTaxablePremium:
      decimals: 2
      type: number
    otherIncome:
      decimals: 2
      type: number
    totalTaxCredits:
      decimals: 2
      type: number
      value: = schedularPayments_withholdingTaxDeducted + interestIncome_totalTaxPaid + pieIncome_totalTaxCredits + dividendIncome_totalRWTCredits + maoriAuthorityDistributions_totalMACredits + partnershipEstateTrustIncome_totalTaxCredits + rlwtCredit
    totalIncomeSubtotal:
      decimals: 2
      type: number
      value: = schedularPayments_totalIncome + interestIncome_totalIncome + pieIncome_totalIncome + dividendIncome_totalGrossDividends + maoriAuthorityDistributions_totalMADistributions + partnershipEstateTrustIncome_totalIncome + overseasIncome_totalIncome + businessOrRentalIncome + otherIncome + saleOfProperty
    donationsMade:
      decimals: 2
      type: number
    subventionPaymentsToFrom:
      decimals: 2
      type: number
    totalTaxableIncome:
      decimals: 2
      type: number
      value:  = ROUNDDOWN(incomeAfterNetLosses + netLossesToFrom + subventionPaymentsToFrom,0)
    # taxOnTaxableIncome:
    #   decimals: 2
    #   type: number
#      value:  '= IF(totalTaxableIncome > 0 , totalTaxableIncome * 0.28 , 0)'
    overseasIncometotalTaxPaid:
      decimals: 2
      type: number
      value:  =overseasIncome_totalTaxPaid
    taxAfterOverseasTax:
      type: number
      decimals: 2
      value: =IF(taxOnTaxableIncome >= overseasIncometotalTaxPaid , taxOnTaxableIncome - overseasIncometotalTaxPaid , 0)
    foreignInvestorTaxCredit:
      decimals: 2
      type: number
    taxAfterFInvestorTax:
      type: number
      decimals: 2
      value: =taxAfterOverseasTax - foreignInvestorTaxCredit
    imputationCredits:
      decimals: 2
      type: number
      value: =dividendIncome_totalImputationCredits
    taxAfterImpCredits:
      type: number
      decimals: 2
      value:  =IF(taxAfterFInvestorTax >= imputationCredits , taxAfterFInvestorTax - imputationCredits ,0)
  # If Div imp credits greater than tax available, then they should be converted and carried forward, done in workpaper?
    totalremainingTaxCredits:
      decimals: 2
      type: number
      value:  =schedularPayments_withholdingTaxDeducted + interestIncome_totalTaxPaid + pieIncome_totalTaxCredits + dividendIncome_totalRWTCredits + maoriAuthorityDistributions_totalMACredits + partnershipEstateTrustIncome_totalTaxCredits + rlwtCredit
    residualIncomeTax:
      decimals: 2
      type: number
      value:  =taxAfterImpCredits - totalremainingTaxCredits
    totIncomeNetLoss:
      decimals: 2
      type: number
    provisionalTaxPaid:
      decimals: 2
      type: number
    penaltiesDue:
      decimals: 2
      type:  number
    transfersFromOtherReturns:
      decimals: 2
      type: number
    terminalTax:
      decimals: 2
      type: number
      value:  =residualIncomeTax - provisionalTaxPaid + penaltiesDue - transfersFromOtherReturns
# Transfer section
    transferRefundTo:
      type: list
      maxRows:  10
      fields:
        transferIrdNumber:
          type: number
          decimals: 0     
        transferAccountType:
          options:
            - label: Income tax
              value: INC
            - label: Approved issuer levy
              value: AIL
            - label: Account information provider
              value: AIP
            - label: Common reporting standard
              value: CRS
            - label: Dividend withholding tax
              value: DWT
            - label: Fringe benefit tax
              value: FBT
            - label: Gaming machine duty
              value: GMD
            - label: GST on goods sold in satisfaction of debt
              value: GSD
            - label: Goods and services tax
              value: GST
            - label: Resident withholding tax on interest
              value: IPS
            - label: Resident withholding tax on interest (exempt recipient)
              value: IPE
            - label: Non-resident withholding tax
              value: NRT
            - label: Portfolio investment entity tax
              value: PIE
            - label: Payroll subsidy account
              value: PRS
            - label: 'Tax credits - donations, childcare, housekeeper'
              value: REB
            - label: Resident land withholding tax
              value: RLT
            - label: Resident withholding tax on specified dividends
              value: RWT
            - label: Student loan
              value: SLS
            - label: Working for families tax credits
              value: FAM
          type: select
        transferAmount:
          decimals: 2
          type: number
        associatedCustomer:
          defaultValue: false
          type: boolean
        transferFilingPeriod:
          defaultValue: 31/03/2020
          type: date
    transferTotal:
      decimals: 2
      type: number
      value:  =SUM(transferRefundTo:transferAmount)    
    transferRemaining:
      decimals: 2
      type: number
      value:  =terminalTax + transferTotal
    provisionalTax_provisionalTaxOption:
      mandatory: true
      options:
        - label: Standard
          value: STD
        - label: Estimated
          value: EST
        - label: Ratio
          value: RATIO
      type: select
    provTaxEvenSplit:
      defaultValue: false
      type: boolean
    provisionalTax_provisionalTaxStartDate:
      type: date
    provisionalTaxCalc:
      type: number
      decimals: 2
      value:  = IF(residualIncomeTax > 2500 , IF(provisionalTax_provisionalTaxOption = "STD" , residualIncomeTax * 1.05 , 0 ) , 0 )
    provFromTaxManager:
      type: number
      decimals: 2
    provisionalTax_provisionalTaxPayable:
      decimals: 2
      type: number
      value:  = IF(provisionalTax_provisionalTaxOption = "STD" , provisionalTaxCalc , provFromTaxManager )
    paymentsMadeToNonResidents:
      type: boolean
      defaultValue: false
    withholdingTaxDeducted:
      type: boolean
      defaultValue: false
    foreignIncomeDisclosure:
      type: boolean
      defaultValue: false    
    repurchasedRedeemedCancelledShares:
      type: number
      decimals: 2
    foreignSourcedDividends:
      type: boolean
      defaultValue: false
    foreignControlIndicator:
      type: boolean
      defaultValue: false
    lowestEconomicShareholderInterest:
      type: number
      decimals: 2
    shareholderListType:
      type: list
      fields:
        shareholder_name:
          type: text
        shareholder_irdNumber:
          type: number
          decimals: 0
        shareholder_remuneration:
          type: number
          decimals: 2
        shareholder_loansFromCompany:
          type: number
          decimals: 2
        shareholder_currentAccountBalance:
          type: number
          decimals: 2
        shareholder_shareholderLossOffsets:
          type: number
          decimals: 2
        shareholder_subventionPayments:
          type: number
          decimals: 2
        
    